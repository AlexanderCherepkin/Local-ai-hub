function escapeHTML(n){return String(n).replace(/[&<>"']/g,(function(n){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[n]}))}function setSendLoading(n=!0){const e=document.getElementById("ai-send-btn");if(!e)return;const t=e.querySelector(".spinner"),o=e.querySelector(".send-icon");t&&o&&(t.style.display=n?"inline-block":"none",o.style.display=n?"none":"inline-block")}void 0===window.currentLang&&(window.currentLang=getLangFromURL()),void 0===window.fallbackLang&&(window.fallbackLang="en"),void 0===window.translations&&(window.translations={}),void 0===window.welcomeShown&&(window.welcomeShown=!1),void 0===window.chatBox&&(window.chatBox=null),window.appendMessage=function(n,e){if(!window.chatBox)return;const t=document.createElement("div");t.className=`message ${n}`,t.innerHTML="assistant"===n?e:escapeHTML(e),window.chatBox.appendChild(t),window.chatBox.scrollTop=window.chatBox.scrollHeight},window.showSkeleton=function(){const n=document.getElementById("ai-chat-response");n&&(n.style.display="block"),setSendLoading(!0)},window.hideSkeleton=function(){const n=document.getElementById("ai-chat-response");n&&(n.style.display="none"),setSendLoading(!1)},window.toggleChatWidget=function(){const n=document.getElementById("chat-body");if(!n)return;const e="block"===n.style.display;n.style.display=e?"none":"block",e||window.welcomeShown||(window.appendMessage("assistant",window.translations.chat_welcome||"üëã –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫.<br>–ü–æ–º–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è, –æ–±—ä—è—Å–Ω—é —Ä–∞–±–æ—Ç—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, —Ä–∞—Å—Å–∫–∞–∂—É –ø—Ä–æ –ò–ò –¥–ª—è –±–∏–∑–Ω–µ—Å–∞.<br><b>–°–ø—Ä–æ—Å–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ!</b>"),window.welcomeShown=!0,setTimeout((()=>{const n=document.getElementById("chat-input");n&&n.focus()}),150))},window.initChat=function(){window.chatBox=document.getElementById("chat-box");const n=document.getElementById("chat-input"),e=document.getElementById("ai-send-btn"),t=document.getElementById("chat-body");function o(){const e=n.value.trim();e&&(window.appendMessage("user",e),n.value="",n.focus(),window.showSkeleton(),fetch("/api/chat.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})}).then((async n=>{let e={};try{e=await n.json()}catch(n){return window.hideSkeleton(),void window.appendMessage("assistant",`<span style="color:#c00">${window.translations.chat_generic_error||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞."}</span>`)}if(window.hideSkeleton(),!n.ok||e.error)return void window.appendMessage("assistant",window.translations.chat_api_proxy_error||`<span style="color:#c00">–û—à–∏–±–∫–∞ API:</span> ${e.error?.message||n.statusText}`);const t=e.choices?.[0]?.message?.content||window.translations.chat_no_reply||"–û—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω";window.appendMessage("assistant",t)})).catch((n=>{window.hideSkeleton(),window.appendMessage("assistant",`<span style="color:#c00">${window.translations.chat_generic_error||"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."}</span>`),console.error(n)})))}window.chatBox&&n&&e&&t?(t.style.display="none",e.addEventListener("click",o),n.addEventListener("keydown",(n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),o())}))):console.error("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –æ–¥–∏–Ω –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–∞—Ç–∞ (chat-box, chat-input, ai-send-btn, chat-body)")},document.addEventListener("DOMContentLoaded",(()=>{const n=document.getElementById("chat-header-button");n&&n.addEventListener("click",window.toggleChatWidget)}));
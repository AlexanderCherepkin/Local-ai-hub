
document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("feedback-overlay"),t=document.getElementById("feedback-content"),n=document.getElementById("feedback-form"),a=document.querySelectorAll('[data-i18n="feedback_button"]'),c=document.getElementById("feedback-close-btn"),o=document.getElementById("feedback-cancel"),l=document.getElementById("feedback-clear"),d=document.getElementById("feedback-submit"),s=document.getElementById("feedback-help-btn"),m=document.getElementById("faq-modal"),i=document.getElementById("faq-modal-close"),f=document.getElementById("insert-example"),u=document.getElementById("faq-btn"),r=document.getElementById("mini-faq"),y={name:document.getElementById("feedback-name"),email:document.getElementById("feedback-email"),message:document.getElementById("feedback-message")},E={name:document.getElementById("feedback-name-error"),email:document.getElementById("feedback-email-error"),message:document.getElementById("feedback-message-error")};if(!e)return;const b="feedback_draft_",k=["name","email","message"];function v(){k.forEach((e=>localStorage.removeItem(b+e)))}let g,p,I,h;function B(){e.style.display="flex",document.body.style.overflow="hidden",g=document.activeElement,n.reset(),k.forEach((e=>{const t=localStorage.getItem(b+e);t&&y[e]&&(y[e].value=t)})),Object.values(E).forEach((e=>e.textContent="")),Object.values(y).forEach((e=>e.classList.remove("valid"))),r&&(r.style.display="none"),p=t.querySelectorAll('button, [href], input, textarea, [tabindex]:not([tabindex="-1"])'),I=p[0],h=p[p.length-1],e.addEventListener("keydown",S),setTimeout((()=>y.name?.focus()),100)}function x(){e.style.display="none",document.body.style.overflow="",g&&g.focus(),e.removeEventListener("keydown",S)}function L(){m&&(m.style.display="none")}function S(e){"Tab"===e.key&&(e.shiftKey&&document.activeElement===I?(e.preventDefault(),h.focus()):e.shiftKey||document.activeElement!==h||(e.preventDefault(),I.focus()))}k.forEach((e=>{y[e]&&y[e].addEventListener("input",(()=>function(e){y[e]&&localStorage.setItem(b+e,y[e].value)}(e)))})),a.forEach((e=>e.addEventListener("click",B))),s&&(s.onclick=function(){m&&(m.style.display="flex")}),c&&(c.onclick=x),o&&(o.onclick=x),e&&(e.onclick=t=>{t.target===e&&x()}),i&&(i.onclick=L),m&&(m.onclick=e=>{e.target===m&&L()}),document.addEventListener("keydown",(t=>{"Escape"!==t.key&&"Esc"!==t.key||(m&&"flex"===m.style.display?L():"flex"===e.style.display&&x())})),l&&(l.onclick=()=>{n.reset(),v(),Object.values(E).forEach((e=>e.textContent="")),Object.values(y).forEach((e=>e.classList.remove("valid"))),r&&(r.style.display="none"),y.name.focus()}),f&&y.message&&(f.onclick=()=>{y.message.value=i18nSafe("feedback_example"),y.message.dispatchEvent(new Event("input"))}),u&&r&&(u.onclick=()=>{r.style.display="none"===r.style.display?"block":"none"});const _={name:e=>e.length>=2,email:e=>/^[^@]+@[^@]+\.[^@]+$/.test(e),message:e=>e.length>=5};Object.keys(y).forEach((e=>{const t=y[e],n=E[e];t&&n&&t.addEventListener("input",(()=>{_[e](t.value)?(n.textContent="",t.classList.add("valid")):(n.textContent=i18nSafe(`feedback_error_${e}`),t.classList.remove("valid"))}))})),n&&(n.onsubmit=function(e){e.preventDefault();let t=!0;if(Object.keys(y).forEach((e=>{const n=y[e];n&&!_[e](n.value)&&(E[e].textContent=i18nSafe(`feedback_error_${e}`),t=!1)})),t&&d){const e=d.textContent;d.textContent=i18nSafe("feedback_sending"),d.disabled=!0,setTimeout((()=>{d.textContent=e,d.disabled=!1,n.reset(),v(),Object.values(y).forEach((e=>e.classList.remove("valid"))),alert(i18nSafe("feedback_thankyou")),x()}),1100)}})}));